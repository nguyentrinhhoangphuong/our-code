<div class="uk-inline">
  <button type="button" class="uk-button uk-button-default">
    <img src="/wp-content/uploads/2025/10/Flag-1.svg" alt="flag-usa" class="flag-icon uk-border-circle" id="current-flag"/>
  </button>
  <div uk-dropdown="mode: click; pos: bottom-center">
    <ul class="uk-list lang-dropdown">
      <li>
        <a href="#" onclick="switchLanguage('en|vi'); return false;" class="uk-flex uk-flex-middle gap-2">
          VI
          <img src="/wp-content/uploads/2025/10/vnflat.svg" alt="Vietnamese" style="width:24px; height:24px;"/>
        </a>
      </li>
      <li>
        <a href="#" onclick="switchLanguage('en|en'); return false;" class="uk-flex uk-flex-middle gap-2">
          EN
          <img src="/wp-content/uploads/2025/10/united-kingdom-flat.svg" alt="English" style="width:24px; height:24px;"/>
        </a>
      </li>
    </ul>
  </div>
</div>

<script>
// Lưu ngôn ngữ hiện tại
let currentLang = localStorage.getItem('selectedLanguage') || 'en';

// Cấu hình flags
const flags = {
  'en': '/wp-content/uploads/2025/10/Flag-1.svg',
  'vi': '/wp-content/uploads/2025/10/Flag.svg'
};

function initLanguage() {
  const flagImg = document.getElementById('current-flag');
  if (flagImg && flags[currentLang]) {
    flagImg.src = flags[currentLang];
    flagImg.alt = currentLang === 'en' ? 'flag-usa' : 'flag-vietnam';
  }
  
  // Nếu đã lưu là tiếng Việt, trigger GTranslate
  if (currentLang === 'vi' && typeof doGTranslate === 'function') {
    setTimeout(() => doGTranslate('en|vi'), 100);
  }
}

function switchLanguage(langPair) {
  // Lấy ngôn ngữ đích từ cặp 'en|vi' hoặc 'en|en'
  const targetLang = langPair.split('|')[1];
  
  // Cập nhật currentLang
  currentLang = targetLang;
  localStorage.setItem('selectedLanguage', targetLang);
  
  // Cập nhật icon cờ
  const flagImg = document.getElementById('current-flag');
  if (flagImg && flags[targetLang]) {
    flagImg.src = flags[targetLang];
    flagImg.alt = targetLang === 'en' ? 'flag-usa' : 'flag-vietnam';
  }
  
  if (typeof UIkit !== 'undefined') {
    const dropdown = document.querySelector('[uk-dropdown]');
    if (dropdown) {
      UIkit.dropdown(dropdown).hide();
    }
  }
  
  console.log('Switching to language:', targetLang);
  
  // Set cookie googtrans
  const domain = window.location.hostname;
  document.cookie = `googtrans=/en/${targetLang}; path=/; domain=${domain}`;
  document.cookie = `googtrans=/en/${targetLang}; path=/`;
  
  console.log('Set cookie, reloading page...');
  
  // Xóa hash để URL gọn gàng
  if (targetLang === 'en') {
    // Nếu chuyển về tiếng Anh, xóa cookie
    document.cookie = `googtrans=; path=/; domain=${domain}; expires=Thu, 01 Jan 1970 00:00:00 UTC`;
    document.cookie = `googtrans=; path=/; expires=Thu, 01 Jan 1970 00:00:00 UTC`;
  }
  
  // Reload trang để apply translation (không dùng hash)
  setTimeout(() => {
    // Xóa hash trước khi reload
    history.replaceState(null, null, window.location.pathname + window.location.search);
    window.location.reload();
  }, 100);
}

// Khởi tạo khi trang load
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', initLanguage);
} else {
  initLanguage();
}
</script>
