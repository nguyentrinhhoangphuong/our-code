add_action('wp_footer', function() { 
  ?>
    <div id="modal-full" class="uk-modal-full" uk-modal>
      <div class="uk-modal-dialog uk-flex uk-flex-center uk-flex-middle uk-background-secondary" uk-height-viewport style="overflow:hidden;">
        <button class="uk-modal-close-full" uk-icon="close-modal-full" type="button"></button>

        <div class="uk-width-1-1 uk-flex uk-flex-center uk-flex-middle">
          <div class="uk-position-relative uk-visible-toggle uk-light" tabindex="-1" uk-slider="center: true">
            <div class="uk-slider-container">
              <div class="uk-slider-items uk-child-width-1-1 uk-child-width-1-3@m  uk-grid">
                <!-- Các slide items ở đây -->
              </div>
            </div>
            
            <!-- Progress Bar -->
            <div class="uk-container uk-container-expand">
                <div class="gallery-progress-bar">
                  <div class="gallery-progress-fill"></div>
              </div>
            </div>

            <a class="uk-position-center-left uk-position-small" href uk-slidenav-previous uk-slider-item="previous"></a>
            <a class="uk-position-center-right uk-position-small" href uk-slidenav-next uk-slider-item="next"></a>
          </div>
        </div>
      </div>
    </div>
  <?php 
});



document.addEventListener('DOMContentLoaded', () => {
  const modal = UIkit.modal('#modal-full');
  const modalEl = document.querySelector('#modal-full');
  const modalSliderList = document.querySelector('#modal-full .uk-slider-items');

  const allImages = document.querySelectorAll('.media-solutions img');
  if (!allImages.length || !modalSliderList) return;

  allImages.forEach((img, index) => {
    const div = document.createElement('div');
    div.innerHTML = `
    <div class="xxx">
      <div class="uk-panel">
        <img src="${img.dataset.src || img.src}" alt="${img.alt || ''}">
      </div>
    </div>
    `;
    modalSliderList.appendChild(div);

    // Thêm sự kiện click cho mỗi hình
    img.style.cursor = 'pointer';
    img.addEventListener('click', e => {
      e.preventDefault();
      modal.show();

      // Chờ modal hiển thị xong rồi mới chuyển slide
      setTimeout(() => {
        const modalSlider = UIkit.slider(document.querySelector('#modal-full [uk-slider]'));
        modalSlider.show(index);
      }, 100);
    });
  });


  // nghe sự kiện khi modal được mở
  UIkit.util.on(modalEl, 'shown', () => {
    const sliderEl = document.querySelector('#modal-full [uk-slider]');
    const progressFill = document.querySelector('.gallery-progress-fill');

    if (!sliderEl || !progressFill) return;

    const slider = UIkit.slider(sliderEl);

    const updateProgress = () => {
      const total = slider.length;
      const currentIndex = slider.index;
      const percent = ((currentIndex + 1) / total) * 100;
      progressFill.style.width = percent + '%';
    };

    updateProgress();

    // nghe sự kiện khi item đã hiển thị
    UIkit.util.on(sliderEl, 'itemshow', () => {
      updateProgress();
    });
  });
});
